\ProvidesPackage{tcbthm}
\NeedsTeXFormat{LaTeX2e}

\renewcommand{\qedsymbol}{$_{\scriptstyle \substack{\textsc{quod}\\\textsc{erat}\\\textsc{dem}\scalebox{0.53}{$\blacksquare$}}}$}

\newcommand{\qbreak}{\tcblower}
\newcommand{\envbreak}{%
    \begin{tikzpicture}
        \path[use as bounding box] (0,0) -- (\linewidth,0);
        \draw[color=main!75!black,dashed,dash phase=2pt]
        (0-\kvtcb@leftlower-\kvtcb@boxsep,0)--
        (\linewidth+\kvtcb@rightlower+\kvtcb@boxsep,0);
    \end{tikzpicture}%
}
\newcommand{\retcbcnt}[1]{\setcounter{tcb@cnt@#1}{0}}
\newcommand{\tcbcnt}[2]{\setcounter{tcb@cnt@#1}{#2}}





\newtcolorbox{note}{
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
    notitle,
    enforce breakable, left=5mm,
    opacityback=0.3, opacityframe=0.3,
    before skip=10pt, after skip=10pt,
    colback=gray!3!white, colframe=gray!30!white,
    opacityback=\thmopacity,
    opacityframe=\thmopacity,
}
\RequirePackage{wasysym} %\smiley
\newtcolorbox{mathnote}{
    notitle,
    opacityback=\thmopacity, opacityframe=\thmopacity,
    before skip=10pt, after skip=10pt,
    enforce breakable, left=5mm,
    colback=yellow!3!white, colframe=orange!20!white,
    after upper={\hfill$\smiley$},
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
}
\newtcolorbox{tbox}[2][]{
    colbacktitle=orange!10!white,
    colback=orange!10!white,coltitle=orange!70!black,
    opacityframe=0.3,
    title={\centering#2},fonttitle=\bfseries,#1,
    opacitybacktitle=\thmopacity,
    opacityback=\thmopacity, opacityframe=\thmopacity,
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
}
\newtheorem*{hint}{Hint}
\tcolorboxenvironment{hint}{
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
    enforce breakable, enhanced,
    opacityback=\thmopacity, opacityframe=\thmopacity,
    before skip=10pt, after skip=10pt,
    colback=yellow!30!white, colframe=yellow!30!white,
    after upper={\hfill$\bigstar$}
}{}
\newtheorem{remark}{Remark}
\tcolorboxenvironment{remark}{
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
    enforce breakable, enhanced,
    opacityback=\thmopacity, opacityframe=\thmopacity,
    before skip=10pt, after skip=10pt,
    colback=orange!15!white, colframe=orange!15!white,
    after upper={\hfill\textcolor{ecolor}{$\triangle$}}
}{}
\tcolorboxenvironment{proof}{
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
    enforce breakable, left=5mm,
    opacityback=\thmopacity-0.1, opacityframe=\thmopacity-0.1,
    before skip=10pt, after skip=10pt,
    colback=yellow!3!white, colframe=orange!20!white
}{}
\newtcbtheorem{question}{Question}{
    enforce breakable, enhanced,
    opacityback=\thmopacity, opacityframe=\thmopacity,
    opacitybacktitle=\thmopacity,
    colframe=blue!30!white, colback=blue!3!white,
    colbacktitle=blue!10!white, coltitle=red!30!black,
    arc=1mm, fonttitle=\bfseries,
    separator sign dash,
    after upper={\hfill\textcolor{ecolor}{$\textit{?}\,$}},
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
}{question}
\newtcbtheorem{claim}{Claim}{
    enforce breakable, enhanced,
    attach boxed title to top left = {yshift=-0.50mm, xshift=0mm},
    colframe=pink!70, colback=pink!30!white,
    colbacktitle=pink!40!white, coltitle=pink!30!black,
    arc=1mm, fonttitle=\bfseries,
    separator sign dash,
    after upper={\hfill\textcolor{ecolor}{$\lozenge$}},
    opacityback=\thmopacity, opacityframe=\thmopacity,
    ,boxed title style={
            opacityback=\thmopacity,
            opacityframe=\thmopacity,
            colupper=textcol,
            collower=textcol,
            coltitle=textcol,
            coltext=textcol,
        },
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
}{claim}
\newtcbtheorem{definition}{Definition}{
    enforce breakable, enhanced,
    attach boxed title to top text left = {yshift=-2.50mm},
    colframe=olive!50!white, colback=olive!5!white,
    colbacktitle=olive!10!white, coltitle=olive!30!black,
    arc=1mm, fonttitle=\bfseries,
    separator sign dash,
    after upper={\hfill\textcolor{ecolor}{$\clubsuit$}},
    opacityback=\thmopacity, opacityframe=\thmopacity,
    opacitybacktitle=\thmopacity,
    ,boxed title style={
            opacityback=\thmopacity,
            opacityframe=\thmopacity,
            colupper=textcol,
            collower=textcol,
            coltitle=textcol,
            coltext=textcol,
        },
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
}{definition}
\newtcbtheorem{corollary}{Corollary}{
    enforce breakable, enhanced,
    attach boxed title to top text left = {yshift=-2.50mm},
    colframe=green!50!white, colback=green!2!white,
    colbacktitle=green!10!white, coltitle=green!30!black,
    arc=1mm, fonttitle=\bfseries,
    separator sign dash,
    opacityback=\thmopacity, opacityframe=\thmopacity,
    opacitybacktitle=\thmopacity,
    after upper={\hfill\textcolor{ecolor}{$\heartsuit$}}
    ,boxed title style={
            opacityback=\thmopacity,
            opacityframe=\thmopacity,
            colupper=textcol,
            collower=textcol,
            coltitle=textcol,
            coltext=textcol,
        },
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
}{corollary}
\newtcbtheorem{theorem}{Theorem}{
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
    enforce breakable, enhanced,
    attach boxed title to top text left = {yshift=-2.50mm},
    colframe=cyan!50!white, colback=cyan!2!white,
    colbacktitle=cyan!10!white, coltitle=cyan!30!black,
    arc=1mm, fonttitle=\bfseries,
    separator sign dash,
    opacityback=\thmopacity, opacityframe=\thmopacity,
    opacitybacktitle=\thmopacity,
    ,boxed title style={
            opacityback=\thmopacity,
            opacityframe=\thmopacity,
            colupper=textcol,
            collower=textcol,
            coltitle=textcol,
            coltext=textcol,
        },
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
}{theorem}
\newtcbtheorem{lemma}{Lemma}{
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
    enforce breakable, enhanced,
    attach boxed title to top text left = {yshift=-2.50mm},
    colframe=teal!40!white, colback=teal!4!white,
    colbacktitle=teal!10!white, coltitle=teal!40!black,
    arc=1mm, fonttitle=\bfseries,
    separator sign dash,
    opacityback=\thmopacity, opacityframe=\thmopacity,
    after upper={\hfill\textcolor{ecolor}{$\spadesuit$}},
    opacitybacktitle=\thmopacity,
    ,boxed title style={
            opacityback=\thmopacity,
            opacityframe=\thmopacity,
            colupper=textcol,
            collower=textcol,
            coltitle=textcol,
            coltext=textcol,
        },
    colupper=textcol,
    collower=textcol,
    coltitle=textcol,
}{lemma}
\RequirePackage{varwidth}
\newtcbtheorem{exercise}{Exercise}{
    colupper=textcol,
    collower=textcol,
    opacityback=\thmopacity, opacityframe=\thmopacity,
    enforce breakable, enhanced,
    before skip=2mm, after skip=2mm,
    colback=black!5, colframe=black!50, boxrule=0.2mm,
    attach boxed title to top={},
    varwidth boxed title*=-3cm,
    boxed title style={frame code={
                    \path[fill=tcbcolback!30!black]
                    ([yshift=-1mm,xshift=-1mm]frame.north west)
                    arc[start angle=0,end angle=180,radius=1mm]
                    ([yshift=-1mm,xshift=1mm]frame.north east)
                    arc[start angle=180,end angle=0,radius=1mm];
                    \path[left color=tcbcolback!60!black,right color=tcbcolback!60!black,
                        middle color=tcbcolback!80!black]
                    ([xshift=-2mm]frame.north west) -- ([xshift=2mm]frame.north east)
                    [rounded corners=1mm]-- ([xshift=1mm,yshift=-1mm]frame.north east)
                    -- (frame.south east) -- (frame.south west)
                    -- ([xshift=-1mm,yshift=-1mm]frame.north west)
                    [sharp corners]-- cycle;
                },interior engine=empty,
        },
    fonttitle=\bfseries,
    after = {\tcbcnt{question}{0}}
}{exercise}
\newtcbtheorem{unit}{Unit}{
    colupper=textcol,
    collower=textcol,
    opacityback=\thmopacity, opacityframe=\thmopacity,
    enforce breakable, enhanced,
    before skip=2mm, after skip=2mm,
    colback=black!5, colframe=black!50, boxrule=0.2mm,
    attach boxed title to top={},
    varwidth boxed title*=-3cm,
    boxed title style={frame code={
                    \path[fill=tcbcolback!30!black]
                    ([yshift=-1mm,xshift=-1mm]frame.north west)
                    arc[start angle=0,end angle=180,radius=1mm]
                    ([yshift=-1mm,xshift=1mm]frame.north east)
                    arc[start angle=180,end angle=0,radius=1mm];
                    \path[left color=tcbcolback!60!black,right color=tcbcolback!60!black,
                        middle color=tcbcolback!80!black]
                    ([xshift=-2mm]frame.north west) -- ([xshift=2mm]frame.north east)
                    [rounded corners=1mm]-- ([xshift=1mm,yshift=-1mm]frame.north east)
                    -- (frame.south east) -- (frame.south west)
                    -- ([xshift=-1mm,yshift=-1mm]frame.north west)
                    [sharp corners]-- cycle;
                },interior engine=empty,
        },
    fonttitle=\bfseries,
    after = {\tcbcnt{question}{0}}
}{unit}
\newtcbtheorem{chapter}{Chapter}{
    colupper=textcol,
    collower=textcol,
    opacityback=\thmopacity, opacityframe=\thmopacity,
    enforce breakable, enhanced,
    before skip=2mm, after skip=2mm,
    colback=black!5, colframe=black!50, boxrule=0.2mm,
    attach boxed title to top={},
    varwidth boxed title*=-3cm,
    boxed title style={frame code={
                    \path[fill=tcbcolback!30!black]
                    ([yshift=-1mm,xshift=-1mm]frame.north west)
                    arc[start angle=0,end angle=180,radius=1mm]
                    ([yshift=-1mm,xshift=1mm]frame.north east)
                    arc[start angle=180,end angle=0,radius=1mm];
                    \path[left color=tcbcolback!60!black,right color=tcbcolback!60!black,
                        middle color=tcbcolback!80!black]
                    ([xshift=-2mm]frame.north west) -- ([xshift=2mm]frame.north east)
                    [rounded corners=1mm]-- ([xshift=1mm,yshift=-1mm]frame.north east)
                    -- (frame.south east) -- (frame.south west)
                    -- ([xshift=-1mm,yshift=-1mm]frame.north west)
                    [sharp corners]-- cycle;
                },interior engine=empty,
        },
    fonttitle=\bfseries,
    after = {\tcbcnt{question}{0}}
}{chapter}


\newcommand{\newq}[3][]{\begin{question}{#1}{q#2}#3\end{question}}
\newcommand{\newe}[3][]{\begin{exercise}{#1}{e#2}#3\end{exercise}}
\newcommand{\newu}[3][]{\begin{unit}{#1}{u#2}#3\end{unit}}
\newcommand{\newch}[3][]{\begin{chapter}{#1}{ch#2}#3\end{chapter}}
\newcommand{\newd}[3][]{\begin{definition}{#1}{d#2}#3\end{definition}}
\newcommand{\newl}[3][]{\begin{lemma}{#1}{l#2}#3\end{lemma}}
\newcommand{\newcl}[3][]{\begin{claim}{#1}{cl#2}#3\end{claim}}
\newcommand{\newco}[3][]{\begin{corollary}{#1}{co#2}#3\end{corollary}}
\newcommand{\newt}[3][]{\begin{theorem}{#1}{t#2}#3\end{theorem}}

\newcommand{\newr}[1]{\begin{remark}#1\end{remark}}
\newcommand{\newn}[1]{\begin{note}
        \parskip=\skippar\parindent=\indentpar#1\end{note}}
\newcommand{\newm}[1]{\begin{mathnote}
        \parskip=\skippar\parindent=\indentpar#1\end{mathnote}}
\newcommand{\newh}[1]{\begin{hint}#1\end{hint}}
\newcommand{\newp}[1]{\begin{proof}#1
        \parskip=\skippar\parindent=\indentpar\end{proof}}
\newcommand{\newtbox}[2][]{\begin{tbox}{#1}#2\end{tbox}}
